cmake_minimum_required(VERSION 4.2)
project(NewbieRenderer LANGUAGES CXX)

# Require C++23; MSVC ships the C++ Standard Library modules (import std)
# with recent VS 2022 toolsets.
# set(CMAKE_CXX_STANDARD 23)
# set(CMAKE_CXX_STANDARD_REQUIRED ON)
# set(CMAKE_CXX_EXTENSIONS OFF)


if(NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE "Release" CACHE STRING "Choose the type of build." FORCE)
    set_property(CACHE CMAKE_BUILD_TYPE PROPERTY STRINGS "Debug" "Release" "RelWithDebInfo")
endif()

# find_package(imgui CONFIG REQUIRED) 
find_package(glm REQUIRED)
find_package(glfw3 CONFIG REQUIRED)
find_package(VulkanMemoryAllocator CONFIG REQUIRED)
find_package(Vulkan REQUIRED)

function(nr_apply_msvc_settings target)
    # WINDOWS-FLAG
    if(MSVC)
        set_property(TARGET ${target} PROPERTY MSVC_RUNTIME_LIBRARY "MultiThreadedDLL")
        target_compile_options(${target} PRIVATE /MP)
        
        target_compile_options(${target} PRIVATE
            $<$<CONFIG:Debug>:/W4>
            $<$<CONFIG:Debug>:/WX>
            $<$<CONFIG:Debug>:/fsanitize=address>)
        target_link_options(${target} PRIVATE
            $<$<CONFIG:Debug>:/INCREMENTAL:NO>
            $<$<CONFIG:Debug>:/DEBUG:FASTLINK>
            $<$<CONFIG:Release>:/INCREMENTAL:NO>
            $<$<CONFIG:RelWithDebInfo>:/INCREMENTAL:NO>)
    endif()
endfunction()


function(nr_add_executable target)
    add_executable(${target} ${ARGN})
    nr_apply_msvc_settings(${target})
endfunction()

function(nr_add_library target)
    add_library(${target} ${ARGN})
    nr_apply_msvc_settings(${target})
endfunction()

add_subdirectory(src)
